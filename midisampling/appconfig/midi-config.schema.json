{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "MIDI Sampling Configuration",
    "description": "Structure of the MIDI sampling configuration.",
    "definitions": {
        "def_midi_config": {
            "type": "object",
            "additionalProperties": false,
            "description": "The main configuration body",
            "properties": {
                "output_dir": {
                    "type": "string",
                    "description": "Directory for the output of the sampled audio files."
                },
                "processed_output_dir": {
                    "type": "string",
                    "description": "Directory for the output of processed sampled audio files."
                },
                "output_prefix_format": {
                    "type": "string",
                    "description": "Prefix for the filenames of the sampled audio files. The following placeholders can be used: {pc_msb}, {pc_lsb}, {pc}, {key_root}, {key_low}, {key_high}, {min_velocity} {max_velocity} {velocity}.",
                    "default": "{pc}_{pc_msb}_{pc_lsb}_{key_root}_{velocity}"
                },
                "pre_send_smf_path_list" : {
                    "type":"array",
                    "description": "These file(s) will be sent to the MIDI device before sampling once e.g. GM Reset, CC Reset, etc.",
                    "items": {
                        "type": "string",
                        "description": "Path to the SMF(*.mid/*.midi) file(s)"
                    },
                    "default": []
                },
                "midi_channel": {
                    "type": "integer",
                    "description": "MIDI channel number for sampling.",
                    "minimum": 0,
                    "maximum": 15
                },
                "midi_program_change_list" : {
                    "type":"array",
                    "description": "List of MIDI program change (MSB, LSB, Program No) for sampling.",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                            "msb": {
                                "type": "integer",
                                "description": "MSB value for the MIDI program change.",
                                "minimum": 0,
                                "maximum": 127
                            },
                            "lsb": {
                                "type": "integer",
                                "description": "LSB value for the MIDI program change.",
                                "minimum": 0,
                                "maximum": 127
                            },
                            "program": {
                                "type": "integer",
                                "description": "Program number for the MIDI program change.",
                                "minimum": 0,
                                "maximum": 127
                            }
                        }
                    }
                },
                "sample_zone_complex" :{
                    "type":"array",
                    "description": "List of keymaps for the sampled MIDI notes.",
                    "items": {
                        "$ref": "#/definitions/def_sample_zone_complex"
                    }
                },
                "sample_zone" :{
                    "type":"array",
                    "description": "List of keymaps for the sampled MIDI notes.",
                    "items": {
                        "$ref": "#/definitions/def_sample_zone"
                    }
                },
                "midi_pre_wait_duration": {
                    "type": "number",
                    "description": "Pre-wait time (in seconds) before sampling. A value of `0.6` or higher is recommended."
                },
                "midi_note_duration": {
                    "type": "number",
                    "description": "Length of the MIDI note to be sampled (in seconds)."
                },
                "midi_release_duration": {
                    "type": "number",
                    "description": "Wait time (in seconds) after the release of the sampled MIDI note. Only integer values can be specified."
                }
            },
            "required": [
                "output_dir",
                "processed_output_dir",
                "midi_channel",
                "midi_program_change_list",
                "midi_pre_wait_duration",
                "midi_note_duration",
                "midi_release_duration"
            ],
            "examples": [
                {
                    "output_dir": "_recorded",
                    "processed_output_dir": "_recorded/_processed",
                    "output_prefix_format": "{pc}_{pc_msb}_{pc_lsb}_{key_root}_{velocity}",
                    "pre_send_smf_path_list": [
                        "path/to/GM_Reset.mid",
                        "path/to/CC_Init.mid"
                    ],
                    "midi_channel": 0,
                    "midi_program_change_list": [
                        { "msb": 0, "lsb": 0, "program": 0},
                        { "msb": 0, "lsb": 0, "program": 1},
                        { "msb": 0, "lsb": 0, "program": 2}
                    ],
                    "sample_zone": [
                        {
                            "key_root": {"from": 40, "to": 41},
                            "velocity_layers": [
                                {
                                    "min": 0,
                                    "max": 63,
                                    "send": 63
                                }
                            ]
                        }
                    ],
                    "sample_zone_complex": [
                        {
                            "key_low": 0,
                            "key_high": 0,
                            "key_root": 40,
                            "velocity_layers": [
                                {
                                    "min": 0,
                                    "max": 63,
                                    "send": 63
                                }
                            ]
                        }
                    ],
                    "midi_pre_wait_duration": 0.6,
                    "midi_note_duration": 2,
                    "midi_release_duration": 1.5
                }
            ]
        },
        "def_midi_message_byte": {
            "type": "integer",
            "description": "Represents the value of the MIDI message byte (0-127)",
            "minimum": 0,
            "maximum": 127
        },
        "def_integer_range": {
            "type": "object",
            "additionalProperties": false,
            "description": "Represents an integer value range",
            "properties": {
                "from": {
                    "type": "integer"
                },
                "to": {
                    "type": "integer"
                }
            },
            "required": [
                "from",
                "to"
            ],
            "examples": [
                { "from": 10, "to": 100 }
            ]
        },
        "def_midi_message_byte_range": {
            "type": "object",
            "additionalProperties": false,
            "description": "Represents the value range (0-127) of the MIDI message byte",
            "properties": {
                "from": {
                    "$ref": "#/definitions/def_midi_message_byte"
                },
                "to": {
                    "$ref": "#/definitions/def_midi_message_byte"
                }
            },
            "required": [
                "from",
                "to"
            ],
            "examples": [
                { "from": 10, "to": 100 }
            ]
        },
        "def_midivelocity_layer": {
            "type": "object",
            "additionalProperties": false,
            "description": "Velocity layer configuration",
            "properties": {
                "min": {
                    "type": "integer",
                    "description": "Minimum velocity value.",
                    "minimum": 0,
                    "maximum": 127
                },
                "max": {
                    "type": "integer",
                    "description": "Maximum velocity value.",
                    "minimum": 0,
                    "maximum": 127
                },
                "send": {
                    "type": "integer",
                    "description": "Velocity value actually sent to the MIDI device when sampling.",
                    "minimum": 0,
                    "maximum": 127
                }
            },
            "required": [
                "min",
                "max",
                "send"
            ],
            "examples": [
                {
                    "min": 0,
                    "max": 127,
                    "send": 127
                }
            ]
        },
        "def_sample_zone_complex": {
            "type": "object",
            "additionalProperties": false,
            "description": "Sample zone complex configuration. The key range, root key, must be specified explicitly.",
            "properties": {
                "key_low": {
                    "type": "integer",
                    "description": "Lowest key number (note number) in the keymap. This value is intended to be used as information for mapping with third-party sampler software.",
                    "minimum": 0,
                    "maximum": 127
                },
                "key_high": {
                    "type": "integer",
                    "description": "Highest key number (note number) in the keymap. This value is intended to be used as information for mapping with third-party sampler software.",
                    "minimum": 0,
                    "maximum": 127
                },
                "key_root": {
                    "type": "integer",
                    "description": "Root key number (note number) in the keymap. This value is intended to be used as information for mapping note-on messages sent to MIDI devices and third-party sampler software when sampling.",
                    "minimum": 0,
                    "maximum": 127
                },
                "velocity_layers": {
                    "type": "array",
                    "items": [
                        {
                            "$ref": "#/definitions/def_midivelocity_layer"
                        }
                    ]
                }
            },
            "required": [
                "key_low",
                "key_high",
                "key_root",
                "velocity_layers"
            ],
            "examples": [
                {
                    "key_low": 0,
                    "key_high": 32,
                    "key_root": 16,
                    "velocity_layers": [
                        { "min": 0,  "max": 31,  "send": 31 },
                        { "min": 32, "max": 63,  "send": 63 },
                        { "min": 64, "max": 95,  "send": 95 },
                        { "min": 96, "max": 127, "send": 127 }
                    ]
                }
            ]
        },
        "def_sample_zone": {
            "type": "object",
            "additionalProperties": false,
            "description": "A simple configuration of sample zone. Unlike the complex version, only the root key can be specified, and individual values of `key_range` are applied as `root key`, `low key` and `high key`.",
            "properties": {
                "keys": {
                    "description": "Root key number (note number) in the keymap.",
                    "$ref": "#/definitions/def_midi_message_byte_range"
                },
                "velocity_layers": {
                    "type": "array",
                    "items":[
                        {
                            "$ref": "#/definitions/def_midivelocity_layer"
                        }
                    ]
                }
            },
            "required": [
                "keys",
                "velocity_layers"
            ],
            "examples": [
                {
                    "keys": { "from": 10, "to": 100 },
                    "velocity_layers": [
                        { "min": 0,  "max": 31,  "send": 31 },
                        { "min": 32, "max": 63,  "send": 63 },
                        { "min": 64, "max": 95,  "send": 95 },
                        { "min": 96, "max": 127, "send": 127 }
                    ]
                }
            ]
        }
    },
    "type": "object",
    "additionalProperties": false,
    "$ref": "#/definitions/def_midi_config"
}
